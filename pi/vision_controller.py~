#!/usr/bin/python
# -*- coding: utf-8 -*-
from picamera.array import PiRGBArray
from picamera import PiCamera
import time
import cv2
import threading

from image import *
from utils import *

N_SLICES = 6

class VisionController(threading.Thread):
	def __init__(self, thread_queue=None, video_buffer=None):
		threading.Thread.__init__(self)
		if thread_queue:
			self.thread_queue = thread_queue
		if video_buffer:
			self.video_buffer = video_buffer
			
		self.images = []
		self.direction = 0
		
		self.cap = cv2.VideoCapture(0)
			
	def run(self):
		while True:
			_, image = self.cap.read()
			
			image = RemoveBackground(image, False)
			
			if image is not None:
				directions = SlicePart(image, self.images, N_SLICES)
				
				for i in range(N_SLICES):
					direction += self.images[i].dir
				fm = RepackImages(self.images)
				
				print(direction)
			self.video_buffer[0] = image
	
	def stop(self):
		self.join()